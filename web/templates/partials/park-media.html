<div class="container">
    {{if and .Media.webcams .Media.webcams.Data}}
        {{if gt (len .Media.webcams.Data) 0}}
            <section class="live-webcams">
                <h2>Live Webcams</h2>
                <div class="webcams-grid">
                    {{range .Media.webcams.Data}}
                        <div class="webcam-card">
                            <div class="webcam-header">
                                <h3>{{if .Title}}{{.Title}}{{else}}Webcam{{end}}</h3>
                            </div>
                            {{if .Images}}
                                {{range $index, $image := .Images}}
                                    {{if eq $index 0}}
                                        <img src="{{$image.URL}}" alt="{{$.Title}}" class="webcam-preview" />
                                    {{end}}
                                {{end}}
                            {{end}}
                            {{if .Description}}
                                <p>{{.Description}}</p>
                            {{end}}
                            {{if .URL}}
                                <a href="{{.URL}}" target="_blank" class="webcam-link">View Webcam</a>
                            {{end}}
                            <div class="webcam-info">
                                <small class="webcam-status">
                                    Status: 
                                    <span class="status {{if eq .Status "Active"}}live{{else}}offline{{end}}">
                                        {{.Status}}
                                    </span>
                                </small>
                                {{if .StatusMessage}}
                                    <small class="webcam-status-message">{{.StatusMessage}}</small>
                                {{end}}
                                {{if .Tags}}
                                    <div class="webcam-tags">
                                        {{range .Tags}}
                                            <span class="tag">{{.}}</span>
                                        {{end}}
                                    </div>
                                {{end}}
                            </div>
                        </div>
                    {{end}}
                </div>
            </section>
        {{end}}
    {{end}}

    {{if and .Media.galleries .Media.galleries.Data}}
    <section class="photo-galleries">
        <h2>Photo Galleries</h2>
        <div class="galleries-grid">
            {{range $gallery := .Media.galleries.Data}}
            <div class="gallery-card" data-gallery-id="{{$gallery.ID}}" onclick="openGallerySlideshow('{{$gallery.ID}}')">
                <div class="gallery-preview">
                    {{if $gallery.Images}}
                        {{range $index, $image := $gallery.Images}}
                            {{if lt $index 3}}
                                <img src="{{$image.Url}}" alt="{{$image.AltText}}" class="gallery-preview-image" />
                            {{end}}
                        {{end}}
                    {{end}}
                    {{if $.Media.galleryAssets}}
                        {{if index $.Media.galleryAssets $gallery.ID}}
                            {{$assetResp := index $.Media.galleryAssets $gallery.ID}}
                            {{if $assetResp.Data}}
                                {{range $index, $asset := $assetResp.Data}}
                                    {{if and (lt $index 6) (ge $index (len $gallery.Images))}}
                                        {{if $asset.FileInfo.Url}}
                                            <img src="{{$asset.FileInfo.Url}}" alt="{{$asset.AltText}}" class="gallery-preview-image" />
                                        {{end}}
                                    {{end}}
                                {{end}}
                            {{end}}
                        {{end}}
                    {{end}}
                    <div class="gallery-overlay">
                        <span class="photo-count">
                            {{$galleryImageCount := len $gallery.Images}}
                            {{$assetCount := 0}}
                            {{if $.Media.galleryAssets}}
                                {{if index $.Media.galleryAssets $gallery.ID}}
                                    {{$assetResp := index $.Media.galleryAssets $gallery.ID}}
                                    {{if $assetResp.Data}}
                                        {{$assetCount = len $assetResp.Data}}
                                    {{end}}
                                {{end}}
                            {{end}}
                            {{if gt $assetCount 0}}
                                {{$assetCount}} photos
                            {{else if gt $galleryImageCount 0}}
                                {{$galleryImageCount}} photos
                            {{else}}
                                Gallery
                            {{end}}
                        </span>
                        <span class="view-gallery-text">Click to view gallery</span>
                    </div>
                </div>
                <div class="gallery-info">
                    <h3>{{$gallery.Title}}</h3>
                    <p>{{$gallery.Description}}</p>
                </div>
            </div>
            {{end}}
        </div>
    </section>

    <!-- Gallery Slideshow Modal -->
    <div id="gallery-slideshow-modal" class="slideshow-modal" onclick="closeGallerySlideshow(event)">
        <div class="slideshow-container" onclick="event.stopPropagation()">
            <div class="slideshow-header">
                <h3 id="slideshow-title"></h3>
                <button class="slideshow-close" onclick="closeGallerySlideshow()">&times;</button>
            </div>
            <div class="slideshow-content">
                <button class="slideshow-nav prev" onclick="previousSlide()">&lt;</button>
                <div class="slideshow-image-container">
                    <img id="slideshow-image" src="" alt="" />
                    <div class="slideshow-image-info">
                        <h4 id="slideshow-image-title"></h4>
                        <p id="slideshow-image-description"></p>
                        <p id="slideshow-image-credit"></p>
                    </div>
                </div>
                <button class="slideshow-nav next" onclick="nextSlide()">&gt;</button>
            </div>
            <div class="slideshow-footer">
                <div class="slideshow-counter">
                    <span id="slideshow-current">1</span> / <span id="slideshow-total">1</span>
                </div>
                <div class="slideshow-thumbnails" id="slideshow-thumbnails"></div>
            </div>
        </div>
    </div>

    <!-- Initialize gallery assets data for JavaScript -->
    <script>
        window.galleryAssetsData = {{if .Media.galleryAssets}}{{.Media.galleryAssets}}{{else}}{}{{end}};
    </script>
    {{end}}

    {{if and .Media.videos .Media.videos.Data}}
    <section class="videos">
        <h2>Videos</h2>
        <div class="videos-grid">
            {{range .Media.videos.Data}}
            <div class="video-card">
                <div class="video-content">
                    <h3>{{.Title}}</h3>
                    <p>{{.Description}}</p>
                    {{if .DurationMs}}
                    <span class="duration">Duration: {{formatDuration .DurationMs}}</span>
                    {{end}}
                    {{if .PermalinkUrl}}
                    <a href="{{.PermalinkUrl}}" target="_blank" class="video-link">Watch Video</a>
                    {{end}}
                    {{if .Transcript}}
                    <details class="transcript">
                        <summary>View Transcript</summary>
                        <div class="transcript-content">{{.Transcript}}</div>
                    </details>
                    {{end}}
                    {{if .Credit}}
                    <p class="credit">Credit: {{.Credit}}</p>
                    {{end}}
                </div>
            </div>
            {{end}}
        </div>
    </section>
    {{end}}

    {{if and .Media.audio .Media.audio.Data}}
    <section class="audio-content">
        <h2>Audio Content</h2>
        <div class="audio-grid">
            {{range .Media.audio.Data}}
            <div class="audio-card">
                {{if .SplashImage.Url}}
                <img src="{{.SplashImage.Url}}" alt="{{.Title}}" class="audio-cover" />
                {{end}}
                <div class="audio-content">
                    <h3>{{.Title}}</h3>
                    <p>{{.Description}}</p>
                    {{if .DurationMs}}
                    <span class="duration">Duration: {{formatDuration .DurationMs}}</span>
                    {{end}}
                    {{if .PermalinkUrl}}
                    <a href="{{.PermalinkUrl}}" target="_blank" class="audio-link">Listen Now</a>
                    {{end}}
                    {{if .Transcript}}
                    <details class="transcript">
                        <summary>View Transcript</summary>
                        <div class="transcript-content">{{.Transcript}}</div>
                    </details>
                    {{end}}
                    {{if .Credit}}
                    <p class="credit">Credit: {{.Credit}}</p>
                    {{end}}
                </div>
            </div>
            {{end}}
        </div>
    </section>
    {{end}}

    {{if and .Audio .Audio.Data}}
    <section class="additional-audio">
        <h2>Audio Tours & Podcasts</h2>
        <div class="audio-list">
            {{range .Audio.Data}}
            <div class="audio-item">
                <div class="audio-header">
                    <h4>{{.Title}}</h4>
                    {{if .DurationMs}}
                    <span class="duration">Duration: {{formatDuration .DurationMs}}</span>
                    {{end}}
                </div>
                <p>{{.Description}}</p>
                {{if .PermalinkUrl}}
                <a href="{{.PermalinkUrl}}" target="_blank" class="listen-link">ðŸŽ§ Listen</a>
                {{end}}
            </div>
            {{end}}
        </div>
    </section>
    {{end}}

    {{if not (or .Media.webcams .Media.galleries .Media.videos .Media.audio .Audio)}}
    <section class="no-media">
        <div class="no-media-content">
            <h2>Media & Galleries</h2>
            <p>No multimedia content available for this park. Check back later for photos, videos, and webcam feeds!</p>
        </div>
    </section>
    {{end}}
</div>
